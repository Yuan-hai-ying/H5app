<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="plug/swiper-4.5.0/dist/css/swiper.min.css">
		<link rel="stylesheet" type="text/css" href="css/topandfoot.css"/><!--头部和底部样式-->
		<link rel="stylesheet" type="text/css" href="css/shop.css"/>
	</head>
	<body>
		<header class="top">
			<div class="mui-input-row mui-search">
			    <div class="search">
		    		<img src="images/search1.png" alt="" />
		    		<span>搜索LED</span>
		    	</div>
			</div>
			<div class="top-r">
				<img src="images/tp.png" alt="" />
				<div>一键调屏</div>
			</div>
		</header>
		<div style="height: 54px;"></div>
		<!--轮播图-->
		<div class="mui-slider">
		  	<div class="mui-slider-group .mui-slider-loop">
			    <!--<div class="mui-slider-item"><img src="images/banner1.jpg" /></div>
			    <div class="mui-slider-item"><img src="images/banner1.jpg" /></div>-->
		  	</div>
		</div>
		<!--轮播图结束-->
		<!--导航栏-->
		<div class="swiper-container">
		    <div class="swiper-wrapper">
		      <!--<div class="swiper-slide">
		      	<div class="swiper-nav">
		      		<img src="images/nav1.png" alt="" />
		      		<p>租赁屏</p>
		      	</div>
		      	<div class="swiper-nav">
		      		<img src="images/nav2.png" alt="" />
		      		<p>小间距屏</p>
		      	</div>
		      	<div class="swiper-nav">
		      		<img src="images/nav3.png" alt="" />
		      		<p>户外全彩</p>
		      	</div>
		      	<div class="swiper-nav">
		      		<img src="images/nav4.png" alt="" />
		      		<p>室内全彩</p>
		      	</div>
		      	<div class="swiper-nav">
		      		<img src="images/nav5.png" alt="" />
		      		<p>单双色</p>
		      	</div>
		      	<div class="swiper-nav">
		      		<img src="images/nav6.png" alt="" />
		      		<p>亚户外P10</p>
		      	</div>
		      </div>-->
		    </div>
		    <!-- Add Arrows -->
		    <div class="swiper-button-next"><i class="mui-icon mui-icon-forward"></i></div>
		    <div class="swiper-button-prev"><i class="mui-icon mui-icon-back"></i></div>
		</div>
		<!--导航栏结束-->
		<!--拼团-->
		<div class="group">
			<div class="mui-content">
				<h4>拼团</h4>
				<div class="mui-row group-box">
			        <!--<div class="mui-col-sm-6 mui-col-xs-6">
			        	<div class="group-item">
			        		<img src="images/shop11.png" alt="" />
			        		<div class="store-name">
			                	强力巨彩 Q1.66 Pro室内全彩led显示屏广告屏LED大屏幕定制 整屏
			                </div>
			                <div class="group-pri">
			                	<div class="group-num1">￥26600</div>
			                	<div class="group-btn">
			                		<div class="group-num2">￥33250</div>
			                		<span>2人拼</span>
			                	</div>
			                </div>
			        	</div>
			        </div>-->
			        <!--<div class="mui-col-sm-6 mui-col-xs-6">
			        	<div class="group-item">
			        		<img src="images/no_shop.png" alt="" />
			                <div class="group-t">
			                	敬请期待...
			                </div>
			        	</div>
			        </div>-->
			    </div>
			</div>
		</div>
		<div class="more" data-type="1">查看更多</div>
		<!--拼团结束-->
		<!--限时抢购-->
		<div class="snap-up">
			<h4>限时抢购</h4>
			<div class="mui-row snap-up-box">
		        <!--<div class="mui-col-sm-6 mui-col-xs-6">
		        	<div class="group-item">
		        		<img src="images/shop11.png" alt="" />
			        	<div class="store-name">
		                	强力巨彩 Q1.66 Pro室内全彩led显示屏广告屏LED大屏幕定制 整屏
		                </div>	
		                <div class="group-pri">
		                	<div class="group-num1">￥26600</div>
		                	<div class="group-num2">
		                		<span class="group-num2-t">￥33250</span>
		                		<div class="snap-time">
			                		<span>10点场</span><span>01:47:21</span>
			                	</div>
		                	</div>
		                </div>
		        	</div>
		        </div>-->
		        <!--<div class="mui-col-sm-6 mui-col-xs-6">
		        	<div class="group-item">
		        		<img src="images/no_shop.png" alt="" />
		                <div class="group-t">
		                	敬请期待...
		                </div>
		        	</div>
		        </div>-->
		    </div>
		</div>
		<div class="more" data-type="2">查看更多</div>
		<!--限时抢购结束-->
		<!--强力巨彩商城-->
		<div class="store-box">
			<h4>强力巨彩</h4>
			<div class="mui-row storeBox">
		        <!--<div class="mui-col-sm-6 mui-col-xs-6">
		        	<div class="group-item">
		        		<img src="images/shop11.png" alt="" />
		                <div class="store-name">
		                	强力巨彩 Q1.66 Pro室内全彩led显示屏广告屏LED大屏幕定制 整屏
		                </div>
		                <div class="store-pri clearfix">
		                	<div class="store-num1">￥26600</div>
		                	<div class="store-num2">
		                		<span>￥33250</span>
		                		<div class="store-num3">已售5936件</div>
		                	</div>
		                </div>
		        	</div>
		        </div>-->
		        <!--<div class="mui-col-sm-6 mui-col-xs-6">
		        	<div class="group-item">
		        		<img src="images/shop11.png" alt="" />
		                <div class="store-name">
		                	强力巨彩 Q1.66 Pro室内全彩led显示屏广告屏LED大屏幕定制 整屏
		                </div>
		                <div class="store-pri clearfix">
		                	<div class="store-num1">￥26600</div>
		                	<div class="store-num2">
		                		<span>￥33250</span>
		                		<div class="store-num3">已售5936件</div>
		                	</div>
		                </div>
		        	</div>
		        </div>-->
		    </div>
		</div>
		<div class="more" data-type="0">查看更多</div>
		<!--强力巨彩商城结束-->
		<!-- 购物车 -->
		<div class="goCart">
			
		</div>
		<!-- 购物车结束 -->
		<div style="height: 50px;"></div>
		<footer class="foot">
			<div class="foot-list" data-page = "index.html">
				<img src="images/home.png" alt=""  />
				<p>首页</p>
			</div>
			<div class="foot-list" data-page = "shop.html">
				<img src="images/shop1.png" alt="" />
				<p class="actionp">商城</p>
			</div>
			<div class="foot-list" data-page = "repository.html">
				<img src="images/knowledge.png" alt="" />
				<p>知识库</p>
			</div>
			<div class="foot-list" data-page = "chat.html">
				<img src="images/talk.png" alt="" />
				<p>聊吧</p>
			</div>
			<div class="foot-list" data-page = "my.html">
				<img src="images/my.png" alt="" style="height: 22px;width: 18px;"/>
				<p>我的</p>
			</div>
		</footer>
		<script type="text/javascript" src="js/jquery-2.1.3.min.js"></script>
		<script src="plug/swiper-4.5.0/dist/js/swiper.min.js"></script>
		<script src="js/mui.min.js"></script>
		<script type="text/javascript" src="js/common.js"></script>
		<script type="text/javascript">
			mui.init()
			
		   //底部导航栏
			mui('body').on('tap', '.goCart', function(e) {
				mui.openWindow({
					url:'shopCart.html'
				});
           	});
			//底部导航栏
			mui('.foot').on('tap', '.foot-list', function(e) {
	            var targetTab = this.getAttribute('data-page');
				mui.openWindow({
			    	url:targetTab
				});
        	});
			
			//更多
			mui('body').on('tap', '.more', function(e) {
	            let type = this.getAttribute('data-type');
				let url = '';
				//0:普通，1：拼团，2限时抢购。
				if(type == 0){
					url = 'shop/shopping.html'
				}
				else if(type == 1){
					url = 'shop/groupShop.html';
				}
				else if(type == 2){
					url = 'shop/desenoShop.html';
				}
				mui.openWindow({
					url:url
				})
        	});
			/**
			 * 商城数据渲染函数：get_shop_data
			 */
			get_shop_data();
			function get_shop_data(){
				mui.ajax(baseUrl + '/api/mall/index',{
					dataType:'json',
					type:'post',
					timeout:'10000',
					headers:{
						'Content-Type':'application/json',
						'Api-Token':'xx'
					},
					success:function(data){
//						console.log(JSON.stringify(data));
						//数据访问成功
						if(data.code == 1000){
							//获取数据
							//banner:轮播图数据
							let banner = data.data.slide_imgs;
							//typesList：分类图标数据
							let typesList = data.data.types_list;
							//pt_product：拼团数据
							let pt_product = data.data.pt_product_list;
							//product：普通商品数据
							let product = data.data.product_list;
							//advert：广告数据
							let advert = data.data.advert;
							
							//执行渲染函数
							render_banner(banner);
							render_types(typesList);
							render_pt_product(pt_product);
							render_product(product);
							render_advert(advert);
						}
					},
					error:function(xhr,type,errorThrown){
						//异常处理
						console.log(type);
						if(type == 'error'){
							renderNoData();
						}

					},
				})
			}
			/*
			 * 获取限时抢购商品函数：getDeseno
			 */
			getDeseno();
			function getDeseno(){
				mui.ajax(baseUrl + '/api/mall/home/index_seckill',{
					dataType:'json',
					type:'post',
					timeout:'10000',
					headers:{
						'Api-Token':'xx'
					},
					success:function(data){
						console.log('获取限时数据');
						console.log(JSON.stringify(data));
						//数据访问成功
						if(data.code == 1000){
							//获取数据
							let deseno= data.data;
							//执行渲染函数
							renderDesenoProducts(deseno);
						}
					},
					error:function(xhr,type,errorThrown){
						//异常处理
						console.log(type);
						if(type == 'error'){
							renderNoData();
						}

					},
				})
			}
			/**
			 *轮播图渲染函数：render_banner 
			 */
			function render_banner(data){
				//console.log(JSON.stringify(data));
				if(data == ''){
					$('.mui-slider').hide();
				}else{
					$('.mui-slider').show();
					mui.each(data,function(index,item){
						let html = `
							<div class="mui-slider-item"><img src="${item.imgurl}" /></div>
							`
						$('.mui-slider-group').append(html);
					})
					//获得slider插件对象,执行轮播
					var gallery = mui('.mui-slider');
					gallery.slider({
					  	interval:3000//自动轮播周期，若为0则不自动播放，默认为0；
					});
				}
			}
			/**
			 *分类图标渲染函数：render_types 
			 */
			function render_types(data){
				if(data == ''){
					$('.swiper-container').hide();
					//隐藏左右跳转箭头
					$('.swiper-button-next').hide();
					$('.swiper-button-prev').hide();
				}else{
					$('.swiper-container').show();
					//分类数量小于6时 
					if(data.length <= 6){
						//隐藏左右跳转箭头
						$('.swiper-button-next').hide();
						$('.swiper-button-prev').hide();
						let html = `<div class="swiper-slide">`;
						mui.each(data,function(index,item){
							html += `
								<div class="swiper-nav" data-id="${item.id}">
						      		<img src="${item.imgurl}" data-id="${item.id}" alt="" />
						      		<p>${item.name}</p>
						      	</div>
						    `
						})
						html+=`</div>`;
						$('.swiper-wrapper').html(html);
					}
					//分类数量大于6时
					else{
						//显示左右跳转箭头
						$('.swiper-button-next').show();
						$('.swiper-button-prev').show();
						let leng = Math.ceil(data.length/6);
						for(let i = 0;i<leng;i++){
							let html = `<div class="swiper-slide">`;
							html+=`</div>`;
							$('.swiper-wrapper').append(html);
						}
						var swiper = new Swiper('.swiper-container', {});
						let aa = -1;
						for(let i = 0;i<data.length;i++){
							let html = `
								<div class="swiper-nav" data-id="${data[i].id}">
						      		<img src="${data[i].imgurl}" data-id="${data[i].id}" alt="" />
						      		<p>${data[i].name}</p>
						      	</div>
						    `;
							if(i % 6 == 0){
								aa = aa+1;
							}
							$('.swiper-slide').eq(aa).append(html);
						}
					}
				}
			}
			/**
			 *拼团渲染函数：render_pt_product 
			 */
			function render_pt_product(data){
//				console.log(JSON.stringify(data));
				if(data.length == 0){
					let html = `
							<div class="mui-col-sm-6 mui-col-xs-6">
					        	<div class="group-item">
					        		<img src="images/no_shop.png" alt="" />
					                <div class="group-t">
					                	敬请期待...
					                </div>
					        	</div>
					        </div>
					        <div class="mui-col-sm-6 mui-col-xs-6">
					        	<div class="group-item">
					        		<img src="images/no_shop.png" alt="" />
					                <div class="group-t">
					                	敬请期待...
					                </div>
					        	</div>
					        </div>
						`
						$('.group-box').append(html);
				}
				else if(data.length == 1){
					let html = `
							<div class="mui-col-sm-6 mui-col-xs-6">
					        	<div class="group-item" data-id="${data[0].id}">
					        		<img src="${data[0].default_imgurl}" alt="" />
					        		<div class="store-name">
					                	${data[0].name}
					                </div>
					                <div class="group-pri">
					                	<div class="group-num1">￥${data[0].group_price}</div>
					                	<div class="group-btn">
					                		<div class="group-num2">￥${data[0].original_price}</div>
					                		<span>${data[0].group_num}人拼</span>
					                	</div>
					                </div>
					        	</div>
					        </div>
					        <div class="mui-col-sm-6 mui-col-xs-6">
					        	<div class="group-item">
					        		<img src="images/no_shop.png" alt="" />
					                <div class="group-t">
					                	敬请期待...
					                </div>
					        	</div>
					        </div>
						`
						$('.group-box').append(html);
				}
				else{
					mui.each(data,function(index,item){
						let html = `
							<div class="mui-col-sm-6 mui-col-xs-6">
					        	<div class="group-item" data-id="${item.id}">
					        		<img src="${item.default_imgurl}" alt="" />
					        		<div class="store-name">
					                	${item.name}
					                </div>
					                <div class="group-pri">
					                	<div class="group-num1">￥${item.group_price}</div>
					                	<div class="group-btn">
					                		<div class="group-num2">￥${item.original_price}</div>
					                		<span>${item.group_num}人拼</span>
					                	</div>
					                </div>
					        	</div>
					        </div>
						`
						$('.group-box').append(html);
					})
				}
			}
			/**
			 *限时抢购渲染函数：renderDesenoProducts 
			 */
			function renderDesenoProducts(data){
				console.log(JSON.stringify(data));
				if(data.length == 0){
					let html = `
						<div class="mui-col-sm-6 mui-col-xs-6">
				        	<div class="group-item">
				        		<img src="images/no_shop.png" alt="" />
				                <div class="group-t">
				                	敬请期待...
				                </div>
				        	</div>
				        </div>
				        <div class="mui-col-sm-6 mui-col-xs-6">
				        	<div class="group-item">
				        		<img src="images/no_shop.png" alt="" />
				                <div class="group-t">
				                	敬请期待...
				                </div>
				        	</div>
				        </div>
					`
					$('.snap-up-box').append(html);
				}
				else if(data.length == 1){
					let html = `
						<div class="mui-col-sm-6 mui-col-xs-6">
				        	<div class="group-item" data-id="${item.id}">
				        		<img src="${item.default_imgurl}" alt="" />
					        	<div class="store-name">
				                	${item.name}
				                </div>
				                <div class="group-pri">
				                	<div class="group-num1">￥${item.now_price}</div>
				                	<div class="group-num2">
				                		<span class="group-num2-t">￥${item.orgin_price}</span>
				                		<div class="snap-time">`;
				                			
				                			
					                		html+=`<span>${item.start_time_str}</span><span>${item.countdown_time}</span>`;
					                	html+=`</div>
				                	</div>
				                </div>
				        	</div>
				        </div>
				        <div class="mui-col-sm-6 mui-col-xs-6">
				        	<div class="group-item">
				        		<img src="images/no_shop.png" alt="" />
				                <div class="group-t">
				                	敬请期待...
				                </div>
				        	</div>
				        </div>
					`
					$('.snap-up-box').append(html);
				}
				else{
					mui.each(data,function(index,item){
						let html = `
							<div class="mui-col-sm-6 mui-col-xs-6">
					        	<div class="group-item" data-id="${item.id}">
					        		<img src="${item.default_imgurl}" alt="" />
						        	<div class="store-name">
					                	${item.name}
					                </div>
					                <div class="group-pri">
					                	<div class="group-num1">￥${item.now_price}</div>
					                	<div class="group-num2">
					                		<span class="group-num2-t">￥${item.orgin_price}</span>
					                		<div class="snap-time">`;
					                			if(item.start_time_str == '距离开场'){
													html+=`<span>${item.start_time_str}</span><span class="start_time">${item.start_time_short}</span>`
					                			}else{
													html+=`<span>${item.start_time_str}</span><span class="start_time">${item.start_time_short}</span>`
					                			}
						                	html+=`</div>
					                	</div>
					                </div>
					        	</div>
					        </div>
						`
						$('.snap-up-box').append(html);
					})
					for(let i = 0;i<$('.start_time').length;i++){
						TimeDown($('.start_time').eq(i).html(),$('.start_time').eq(i));
						console.log($('.start_time').eq(i).html());
					}
				}
			}
			/*
			*倒计时函数：TimeDown
			* end 结束时间
			* box 时间容器
			*/
			function TimeDown(end,box){
				var timer = setInterval(function() {
				if( !!end ){
					let nowTime = new Date();
					let nowH = nowTime.getHours();//获取当前小时
					let nowM = nowTime.getMinutes();//获取当前分
					let nowS = nowTime.getSeconds();//获取当前秒
					let nowSize = nowH * 3600 + nowM * 60 + nowS;//获取总秒数
					let endSize = end * 3600;//获取时间段总秒数
					let diff = endSize - nowSize;//获取时间差
					//console.log('时间差：'+diff);
					day = Math.floor(diff / (60 * 60 * 24));
				    hour = Math.floor(diff / (60 * 60));
				    minute = Math.floor(diff / 60) - (day * 24 * 60) - (hour * 60);
				    second = Math.floor(diff) - (day * 24 * 60 * 60) - (hour * 60 * 60) - (minute *60);
					hour = checkTime(hour);
					minute = checkTime(minute);
					second = checkTime(second);//小于10的话加0
					--diff;
//					console.log('距离开抢时间：'+ hour + "：" + minute + "：" + second);
					box.html(hour + "：" + minute + "：" + second);
					}else {     
						clearInterval( timer );  
						fn("时间到，结束!");    
					}   
				}, 1000); 
			}
			
			/*
			 * checkTime
			 */
			function checkTime(i)
			{
			    if (i < 10) {
			        i = "0" + i;
			    }
			    return i;
			}
			/**
			 *广告栏渲染函数：render_banner 
			 */
			function render_advert(data){
				console.log('广告');
				console.log(JSON.stringify(data));
				let html = `
					
				`
//				$('.snap-up-box').append(html);
			}
			/**
			 *普通商品渲染函数：render_product 
			 */
			function render_product(data){
//				console.log(JSON.stringify(data));
				mui.each(data,function(index,item){
					let html = `
						<div class="mui-col-sm-6 mui-col-xs-6">
		        	<div class="group-item" data-id="${item.id}">
		        		<img src="${item.default_imgurl}" alt="" />
		                <div class="store-name">
		                	${item.name}
		                </div>
		                <div class="store-pri clearfix">
		                	<div class="store-num1">￥${item.now_price}</div>
		                	<div class="store-num2">
		                		<span>￥${item.orgin_price}</span>
		                		<div class="store-num3">已售${item.show_sell_count}件</div>
		                	</div>
		                </div>
		        	</div>
		        </div>
					`
					$('.storeBox').append(html);
				})
			}
			
			function renderNoData(){
				let html = `
					<div class="mui-col-sm-6 mui-col-xs-6">
			        	<div class="group-item">
			        		<img src="images/no_shop.png" alt="" />
			                <div class="group-t">
			                	敬请期待...
			                </div>
			        	</div>
			        </div>
			        <div class="mui-col-sm-6 mui-col-xs-6">
			        	<div class="group-item">
			        		<img src="images/no_shop.png" alt="" />
			                <div class="group-t">
			                	敬请期待...
			                </div>
			        	</div>
			        </div>
				`
				$('.group-box').append(html);
				$('.snap-up-box').append(html);
				$('.storeBox').append(html);
			}
			//点击分类图标跳转对应分类
			mui('.swiper-wrapper').on('tap','img',function(){
				//防止事件冒泡
				event.stopPropagation();
				let id = this.getAttribute('data-id');
				console.log('分类'+id);
				if(id){
					mui.openWindow({
						url:'shop/allShop.html?id='+id
					})
				}
			})
			//点击拼团商品，跳转详情页
			mui('.group').on('tap','.group-item',function(){
				let id = this.getAttribute('data-id');
				// type：1拼团商品，0普通商品，2限时商品
				let type = 1;
				console.log('拼团'+id);
				if(id){
					mui.openWindow({
						url:'shop/shopDetail.html?id='+id+'&type='+type
					})
				}
			})
			//点击限时商品，跳转详情页
			mui('.snap-up').on('tap','.group-item',function(){
				let id = this.getAttribute('data-id');
				// type：1拼团商品，0普通商品，2限时商品
				let type = 2;
				if(id){
					mui.openWindow({
						url:'shop/shopDetail.html?id='+id+'&type='+type
					})
				}
				console.log('限时'+id);
			})
			//点击普通商品，跳转详情页
			mui('.store-box').on('tap','.group-item',function(){
				let id = this.getAttribute('data-id');
				// type：1拼团商品，0普通商品，2限时商品
				let type = 0;
				if(id){
					mui.openWindow({
						url:'shop/shopDetail.html?id='+id+'&type='+type
					})
				}
				console.log('普通'+id);
			})
			/*
			 * 获取倒计时时间段
			 */
		</script>
	</body>

</html>